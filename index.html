<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="AeroVista Division Album Player ‚Äî Volume One ¬∑ Eight Divisions, One Vision" />
  <meta name="theme-color" content="#d1a85a" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="apple-mobile-web-app-title" content="AeroVista" />
  <title>AeroVista Presents ‚Äî Where Vision Takes Flight ¬∑ Vol. ONE</title>
  <link rel="icon" type="image/png" href="assets/img/aerovista_anthem.png" />
  <link rel="apple-touch-icon" href="assets/img/aerovista_anthem.png" />
  <link rel="manifest" href="./manifest.json" />
  <link rel="stylesheet" href="assets/css/style.css" />
</head>
<body>
  <header>
    <div class="brand">
      <div class="logo" aria-hidden="true"></div>
      <div>
        <h1>AeroVista Presents ‚Äî <em>Where Vision Takes Flight</em></h1>
        <div class="subtitle">Volume One ¬∑ Eight Divisions, One Vision</div>
      </div>
    </div>
  </header>

  <main class="wrap">
    <!-- Left: Album Art Slideshow -->
    <section class="panel">
      <div class="slideshow-container">
        <div class="slideshow" id="slideshow"></div>
        <div class="slideshow-controls">
          <button id="prevSlide" class="slide-btn" aria-label="Previous Cover">‚Äπ</button>
          <div class="slide-indicators" id="indicators" aria-label="Cover position"></div>
          <button id="nextSlide" class="slide-btn" aria-label="Next Cover">‚Ä∫</button>
        </div>
      </div>
    </section>

    <!-- Right: Player -->
    <section class="panel">
      <div class="player">
        <audio id="audio" crossorigin="anonymous"></audio>
        <div class="row">
          <button id="prev" title="Previous Track">‚èÆ</button>
          <button id="play" class="primary">‚ñ∫ Play</button>
          <button id="next" title="Next Track">‚è≠</button>
          <div class="seek" title="Seek"><div class="fill" id="seekFill"></div></div>
          <div id="time">0:00 / 0:00</div>
        </div>
        <div class="row">
          <div class="control">
            <label for="bass">Bass</label>
            <div class="slider-container">
              <button class="eq-btn minus" data-target="bass">‚àí</button>
              <input id="bass" type="range" min="-12" max="12" value="0" step="1" />
              <button class="eq-btn plus" data-target="bass">+</button>
            </div>
            <div class="value-display" id="bassValue">0dB</div>
          </div>
          <div class="control">
            <label for="vol">Volume</label>
            <div class="slider-container">
              <button class="eq-btn minus" data-target="vol">‚àí</button>
              <input id="vol" type="range" min="0" max="1" value="0.9" step="0.01" />
              <button class="eq-btn plus" data-target="vol">+</button>
            </div>
            <div class="value-display" id="volValue">90%</div>
          </div>
        </div>
        <canvas id="viz" aria-label="Audio visualizer"></canvas>
      </div>

      <div class="tracks">
        <!-- Populated by JS from assets/data/tracks.json -->
      </div>
    </section>
  </main>

  <!-- Borderlands 4 Updates -->
  <section class="bl4-section" style="background:#0f1320;border:1px solid #22314a;border-radius:12px;margin:20px;padding:20px">
    <div class="brand" style="padding:0 0 15px">
      <h2 style="margin:0;font-size:20px;letter-spacing:.08em;color:#e6f0ff">Borderlands 4 ¬∑ Latest Updates</h2>
      <div class="subtitle" style="color:#8aa0b3">SHiFT Codes, Rotators & Events</div>
    </div>
    
    <!-- Weekly Golden Keys -->
    <div class="bl4-panel" style="background:#141a2a;border:1px solid #22314a;border-radius:8px;padding:16px;margin:12px 0">
      <h3 style="color:#2dd4bf;margin:0 0 10px">Weekly Golden Keys (Expire Oct 26, 2025)</h3>
      <div class="shift-codes">
        <div class="code-item" style="display:flex;align-items:center;gap:10px;margin:8px 0;padding:8px;background:#0d1630;border-radius:6px;border:1px solid #22314a">
          <span class="code" style="font-family:monospace;background:#0b1220;padding:4px 8px;border-radius:4px;color:#e6f0ff">JZFTT-SSTC3-5FTT5-J3TB3-JSB9S</span>
          <span style="color:#86efac">1√ó Golden Key</span>
          <button class="copy-btn" data-code="JZFTT-SSTC3-5FTT5-J3TB3-JSB9S" style="background:#2dd4bf;color:#000;border:none;padding:4px 8px;border-radius:4px;cursor:pointer;font-size:12px">Copy</button>
        </div>
        <div class="code-item" style="display:flex;align-items:center;gap:10px;margin:8px 0;padding:8px;background:#0d1630;border-radius:6px;border:1px solid #22314a">
          <span class="code" style="font-family:monospace;background:#0b1220;padding:4px 8px;border-radius:4px;color:#e6f0ff">BZ6TT-JBWKB-KX3BK-BJT3T-5FS63</span>
          <span style="color:#86efac">1√ó Golden Key</span>
          <button class="copy-btn" data-code="BZ6TT-JBWKB-KX3BK-BJT3T-5FS63" style="background:#2dd4bf;color:#000;border:none;padding:4px 8px;border-radius:4px;cursor:pointer;font-size:12px">Copy</button>
        </div>
        <div class="code-item" style="display:flex;align-items:center;gap:10px;margin:8px 0;padding:8px;background:#0d1630;border-radius:6px;border:1px solid #22314a">
          <span class="code" style="font-family:monospace;background:#0b1220;padding:4px 8px;border-radius:4px;color:#e6f0ff">3Z6T3-CTWWB-KX3BW-3B3BT-SWBSB</span>
          <span style="color:#86efac">1√ó Golden Key</span>
          <button class="copy-btn" data-code="3Z6T3-CTWWB-KX3BW-3B3BT-SWBSB" style="background:#2dd4bf;color:#000;border:none;padding:4px 8px;border-radius:4px;cursor:pointer;font-size:12px">Copy</button>
        </div>
      </div>
    </div>

    <!-- Event Cosmetics -->
    <div class="bl4-panel" style="background:#141a2a;border:1px solid #22314a;border-radius:8px;padding:16px;margin:12px 0">
      <h3 style="color:#2dd4bf;margin:0 0 10px">Horrors of Kairos Event</h3>
      <div class="code-item" style="display:flex;align-items:center;gap:10px;margin:8px 0;padding:8px;background:#0d1630;border-radius:6px;border:1px solid #22314a">
        <span class="code" style="font-family:monospace;background:#0b1220;padding:4px 8px;border-radius:4px;color:#e6f0ff">3S6BB-ZXT93-KRT3W-BT3T3-JW6TZ</span>
        <span style="color:#86efac">"Gourd Your Loins" head + "Hex Appeal" weapon skin</span>
        <button class="copy-btn" data-code="3S6BB-ZXT93-KRT3W-BT3T3-JW6TZ" style="background:#2dd4bf;color:#000;border:none;padding:4px 8px;border-radius:4px;cursor:pointer;font-size:12px">Copy</button>
      </div>
    </div>

    <!-- Weekly Rotators -->
    <div class="bl4-panel" style="background:#141a2a;border:1px solid #22314a;border-radius:8px;padding:16px;margin:12px 0">
      <h3 style="color:#2dd4bf;margin:0 0 10px">This Week's Rotators</h3>
      <div style="color:#e6f0ff;line-height:1.6">
        <p><strong>Maurice's Black Market:</strong> Elpis (Moon) ‚Üí Orbital Shatterfield</p>
        <p><strong>Moxxi's Big Encore:</strong> The Battle Wagon (drops: Bugbear AR, Finnity XXX-L sniper, Compleation Armor)</p>
        <p><strong>Wildcard Mission:</strong> "Dark Subject" ‚Äî Modifiers: Vampiric ‚Ä¢ Cold Hearted ‚Ä¢ Invisible (Guaranteed: Kickballer)</p>
      </div>
    </div>

    <!-- Twitch Drops -->
    <div class="bl4-panel" style="background:#141a2a;border:1px solid #22314a;border-radius:8px;padding:16px;margin:12px 0">
      <h3 style="color:#2dd4bf;margin:0 0 10px">Twitch Drops</h3>
      <p style="color:#e6f0ff;margin:0">"Watch, Drop, and Roll" ECHO-4 Drone Skin ‚Äî watch partnered creators ~15 minutes. Campaign ends <strong style="color:#ff6b6b">Oct 25, 2025</strong>.</p>
    </div>

    <p style="color:#8aa0b3;font-size:12px;margin:10px 0 0">Redeem codes in-game (Menu ‚Üí SHiFT ‚Üí Rewards) or at <a href="https://shift.gearboxsoftware.com/rewards" target="_blank" style="color:#93c5fd">shift.gearboxsoftware.com/rewards</a></p>
  </section>

  <!-- Store -->
  <section class="store-section">
    <div class="brand" style="padding:0 20px 10px">
      <h2 style="margin:0;font-size:20px;letter-spacing:.08em">Mini‚ÄëStore ¬∑ AeroVista Vol. ONE</h2>
      <div class="subtitle">Album merch and prints</div>
    </div>
    <div class="store-row">
      <!-- Items injected -->
    </div>
  </section>

  <!-- Product Modal -->
  <div id="productModal" style="display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.8);z-index:1000;align-items:center;justify-content:center;padding:20px;opacity:0;transition:opacity .3s ease">
    <div id="modalContent" style="background:#0e131b;border:1px solid #1e2633;border-radius:16px;padding:30px;max-width:520px;width:100%;max-height:80vh;overflow-y:auto;position:relative">
      <button id="closeModal" style="position:absolute;top:12px;right:14px;background:none;border:none;color:#9fb0c6;font-size:26px;cursor:pointer">&times;</button>
      <div id="modalProductImage" style="text-align:center;margin-bottom:18px">
        <img id="modalImage" src="" alt="" style="width:220px;height:220px;object-fit:cover;background:#101725;border-radius:8px;padding:10px">
      </div>
      <h2 id="modalTitle" style="color:#e9eef6;font-size:24px;margin:0 0 10px;text-align:center"></h2>
      <p id="modalPrice" style="color:#d1a85a;font-size:20px;font-weight:bold;margin:0 0 12px;text-align:center"></p>
      <p id="modalDescription" style="color:#9fb0c6;font-size:15px;margin:0 0 14px;line-height:1.6"></p>
      <div id="modalFeatures" style="margin:0 0 16px;color:#cbd7ea"></div>
      <div style="text-align:center">
        <button id="buyNowBtn" class="checkout-btn" style="background:linear-gradient(135deg,#d1a85a,#b8941f);color:#000;border:none;padding:14px 26px;border-radius:8px;font-weight:800;cursor:pointer;font-size:15px;text-transform:uppercase;letter-spacing:.5px;width:100%">Buy Now</button>
      </div>
    </div>
  </div>

  <footer>¬© <span id="yr"></span> AeroVista ¬∑ Volume One ‚Äî All rights reserved.</footer>

  <script src="assets/js/app.js"></script>
  <script src="assets/js/product-modal.js"></script>
  <script>
    // BL4 Copy functionality
    document.querySelectorAll('.copy-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        const code = btn.getAttribute('data-code');
        if (!code) return;
        navigator.clipboard.writeText(code).then(() => {
          const old = btn.textContent;
          btn.textContent = 'Copied!';
          btn.style.background = '#86efac';
          setTimeout(() => {
            btn.textContent = old;
            btn.style.background = '#2dd4bf';
          }, 1200);
        });
      });
    });

    // PWA Service Worker Registration
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('./sw.js')
          .then((registration) => {
            console.log('Service Worker registered:', registration.scope);
            
            // Check for updates
            registration.addEventListener('updatefound', () => {
              const newWorker = registration.installing;
              newWorker.addEventListener('statechange', () => {
                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                  // New service worker available, prompt user to refresh
                  if (confirm('New version available! Reload to update?')) {
                    window.location.reload();
                  }
                }
              });
            });
          })
          .catch((error) => {
            console.log('Service Worker registration failed:', error);
          });
      });

      // Listen for service worker updates
      let refreshing = false;
      navigator.serviceWorker.addEventListener('controllerchange', () => {
        if (!refreshing) {
          refreshing = true;
          window.location.reload();
        }
      });
    }

    // PWA Install Prompt
    let deferredPrompt;
    const installButton = document.createElement('button');
    installButton.textContent = 'üì± Install App';
    installButton.style.cssText = 'position:fixed;bottom:20px;right:20px;background:linear-gradient(135deg,#d1a85a,#b8941f);color:#000;border:none;padding:12px 20px;border-radius:8px;font-weight:bold;cursor:pointer;z-index:9999;box-shadow:0 4px 15px rgba(209,168,90,0.3);display:none;';
    installButton.addEventListener('click', async () => {
      if (deferredPrompt) {
        deferredPrompt.prompt();
        const { outcome } = await deferredPrompt.userChoice;
        console.log('User choice:', outcome);
        deferredPrompt = null;
        installButton.style.display = 'none';
      }
    });
    document.body.appendChild(installButton);

    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      deferredPrompt = e;
      installButton.style.display = 'block';
    });

    window.addEventListener('appinstalled', () => {
      console.log('PWA installed');
      deferredPrompt = null;
      installButton.style.display = 'none';
    });
  </script>
</body>
</html>
